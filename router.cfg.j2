set firewall all-ping enable
set firewall broadcast-ping disable

set firewall ipv6-name IPv6_WAN_IN default-action drop
set firewall ipv6-name IPv6_WAN_IN description 'WAN to internal'
set firewall ipv6-name IPv6_WAN_IN enable-default-log

set firewall ipv6-name IPv6_WAN_IN rule 10 action accept
set firewall ipv6-name IPv6_WAN_IN rule 10 description 'Allow established/related'
set firewall ipv6-name IPv6_WAN_IN rule 10 state established enable
set firewall ipv6-name IPv6_WAN_IN rule 10 state related enable

set firewall ipv6-name IPv6_WAN_IN rule 20 action drop
set firewall ipv6-name IPv6_WAN_IN rule 20 description 'Drop invalid state'
set firewall ipv6-name IPv6_WAN_IN rule 20 log enable
set firewall ipv6-name IPv6_WAN_IN rule 20 state invalid enable

set firewall ipv6-name IPv6_WAN_IN rule 30 action accept
set firewall ipv6-name IPv6_WAN_IN rule 30 description 'Allow ICMPv6 destination-unreachable'
set firewall ipv6-name IPv6_WAN_IN rule 30 icmpv6 type destination-unreachable
set firewall ipv6-name IPv6_WAN_IN rule 30 protocol icmpv6

set firewall ipv6-name IPv6_WAN_IN rule 31 action accept
set firewall ipv6-name IPv6_WAN_IN rule 31 description 'Allow ICMPv6 packet-too-big'
set firewall ipv6-name IPv6_WAN_IN rule 31 icmpv6 type packet-too-big
set firewall ipv6-name IPv6_WAN_IN rule 31 protocol icmpv6

set firewall ipv6-name IPv6_WAN_IN rule 32 action accept
set firewall ipv6-name IPv6_WAN_IN rule 32 description 'Allow ICMPv6 time-exceeded'
set firewall ipv6-name IPv6_WAN_IN rule 32 icmpv6 type time-exceeded
set firewall ipv6-name IPv6_WAN_IN rule 32 protocol icmpv6

set firewall ipv6-name IPv6_WAN_IN rule 33 action accept
set firewall ipv6-name IPv6_WAN_IN rule 33 description 'Allow ICMPv6 parameter-problem'
set firewall ipv6-name IPv6_WAN_IN rule 33 icmpv6 type parameter-problem
set firewall ipv6-name IPv6_WAN_IN rule 33 protocol icmpv6

set firewall ipv6-name IPv6_WAN_IN rule 34 action accept
set firewall ipv6-name IPv6_WAN_IN rule 34 description 'Allow ICMPv6 echo-request'
set firewall ipv6-name IPv6_WAN_IN rule 34 icmpv6 type echo-request
set firewall ipv6-name IPv6_WAN_IN rule 34 limit burst 1
set firewall ipv6-name IPv6_WAN_IN rule 34 limit rate 600/minute
set firewall ipv6-name IPv6_WAN_IN rule 34 protocol icmpv6

set firewall ipv6-name IPv6_WAN_IN rule 35 action accept
set firewall ipv6-name IPv6_WAN_IN rule 35 description 'Allow ICMPv6 echo-reply'
set firewall ipv6-name IPv6_WAN_IN rule 35 icmpv6 type echo-reply
set firewall ipv6-name IPv6_WAN_IN rule 35 limit burst 1
set firewall ipv6-name IPv6_WAN_IN rule 35 limit rate 600/minute
set firewall ipv6-name IPv6_WAN_IN rule 35 protocol icmpv6

set firewall ipv6-name IPv6_WAN_LOCAL default-action drop
set firewall ipv6-name IPv6_WAN_LOCAL description 'WAN to router'
set firewall ipv6-name IPv6_WAN_LOCAL enable-default-log

set firewall ipv6-name IPv6_WAN_LOCAL rule 10 action accept
set firewall ipv6-name IPv6_WAN_LOCAL rule 10 description 'Allow established/related'
set firewall ipv6-name IPv6_WAN_LOCAL rule 10 state established enable
set firewall ipv6-name IPv6_WAN_LOCAL rule 10 state related enable

set firewall ipv6-name IPv6_WAN_LOCAL rule 20 action drop
set firewall ipv6-name IPv6_WAN_LOCAL rule 20 description 'Drop invalid state'
set firewall ipv6-name IPv6_WAN_LOCAL rule 20 state invalid enable

set firewall ipv6-name IPv6_WAN_LOCAL rule 30 action accept
set firewall ipv6-name IPv6_WAN_LOCAL rule 30 description 'Allow ICMPv6 destination-unreachable'
set firewall ipv6-name IPv6_WAN_LOCAL rule 30 icmpv6 type destination-unreachable
set firewall ipv6-name IPv6_WAN_LOCAL rule 30 protocol icmpv6

set firewall ipv6-name IPv6_WAN_LOCAL rule 31 action accept
set firewall ipv6-name IPv6_WAN_LOCAL rule 31 description 'Allow ICMPv6 packet-too-big'
set firewall ipv6-name IPv6_WAN_LOCAL rule 31 icmpv6 type packet-too-big
set firewall ipv6-name IPv6_WAN_LOCAL rule 31 protocol icmpv6

set firewall ipv6-name IPv6_WAN_LOCAL rule 32 action accept
set firewall ipv6-name IPv6_WAN_LOCAL rule 32 description 'Allow ICMPv6 time-exceeded'
set firewall ipv6-name IPv6_WAN_LOCAL rule 32 icmpv6 type time-exceeded
set firewall ipv6-name IPv6_WAN_LOCAL rule 32 protocol icmpv6

set firewall ipv6-name IPv6_WAN_LOCAL rule 33 action accept
set firewall ipv6-name IPv6_WAN_LOCAL rule 33 description 'Allow ICMPv6 parameter-problem'
set firewall ipv6-name IPv6_WAN_LOCAL rule 33 icmpv6 type parameter-problem
set firewall ipv6-name IPv6_WAN_LOCAL rule 33 protocol icmpv6

set firewall ipv6-name IPv6_WAN_LOCAL rule 34 action accept
set firewall ipv6-name IPv6_WAN_LOCAL rule 34 description 'Allow ICMPv6 echo-request'
set firewall ipv6-name IPv6_WAN_LOCAL rule 34 icmpv6 type echo-request
set firewall ipv6-name IPv6_WAN_LOCAL rule 34 limit burst 5
set firewall ipv6-name IPv6_WAN_LOCAL rule 34 limit rate 5/second
set firewall ipv6-name IPv6_WAN_LOCAL rule 34 protocol icmpv6

set firewall ipv6-name IPv6_WAN_LOCAL rule 35 action accept
set firewall ipv6-name IPv6_WAN_LOCAL rule 35 description 'Allow ICMPv6 echo-reply'
set firewall ipv6-name IPv6_WAN_LOCAL rule 35 icmpv6 type echo-reply
set firewall ipv6-name IPv6_WAN_LOCAL rule 35 limit burst 5
set firewall ipv6-name IPv6_WAN_LOCAL rule 35 limit rate 5/second
set firewall ipv6-name IPv6_WAN_LOCAL rule 35 protocol icmpv6

set firewall ipv6-name IPv6_WAN_LOCAL rule 36 action accept
set firewall ipv6-name IPv6_WAN_LOCAL rule 36 description 'Allow ICMPv6 Router Advertisement'
set firewall ipv6-name IPv6_WAN_LOCAL rule 36 icmpv6 type router-advertisement
set firewall ipv6-name IPv6_WAN_LOCAL rule 36 protocol icmpv6

set firewall ipv6-name IPv6_WAN_LOCAL rule 37 action accept
set firewall ipv6-name IPv6_WAN_LOCAL rule 37 description 'Allow ICMPv6 Neighbor Solicitation'
set firewall ipv6-name IPv6_WAN_LOCAL rule 37 icmpv6 type neighbor-solicitation
set firewall ipv6-name IPv6_WAN_LOCAL rule 37 protocol icmpv6

set firewall ipv6-name IPv6_WAN_LOCAL rule 38 action accept
set firewall ipv6-name IPv6_WAN_LOCAL rule 38 description 'Allow ICMPv6 Neighbor Advertisement'
set firewall ipv6-name IPv6_WAN_LOCAL rule 38 icmpv6 type neighbor-advertisement
set firewall ipv6-name IPv6_WAN_LOCAL rule 38 protocol icmpv6

set firewall ipv6-name IPv6_WAN_LOCAL rule 50 action accept
set firewall ipv6-name IPv6_WAN_LOCAL rule 50 description 'Allow DHCPv6'
set firewall ipv6-name IPv6_WAN_LOCAL rule 50 destination port 546
set firewall ipv6-name IPv6_WAN_LOCAL rule 50 protocol udp
set firewall ipv6-name IPv6_WAN_LOCAL rule 50 source port 547

set firewall ipv6-receive-redirects disable
set firewall ipv6-src-route disable
set firewall ip-src-route disable
set firewall log-martians enable

set firewall name WAN_IN default-action drop
set firewall name WAN_IN description 'WAN to internal'

set firewall name WAN_IN rule 10 action accept
set firewall name WAN_IN rule 10 description 'Allow established/related'
set firewall name WAN_IN rule 10 state established enable
set firewall name WAN_IN rule 10 state related enable

set firewall name WAN_IN rule 20 action drop
set firewall name WAN_IN rule 20 description 'Drop invalid state'
set firewall name WAN_IN rule 20 state invalid enable

set firewall name WAN_LOCAL default-action drop
set firewall name WAN_LOCAL description 'WAN to router'

set firewall name WAN_LOCAL rule 10 action accept
set firewall name WAN_LOCAL rule 10 description 'Allow established/related'
set firewall name WAN_LOCAL rule 10 state established enable
set firewall name WAN_LOCAL rule 10 state related enable

set firewall name WAN_LOCAL rule 50 action drop
set firewall name WAN_LOCAL rule 50 description 'Drop invalid state'
set firewall name WAN_LOCAL rule 50 state invalid enable

set firewall receive-redirects disable
set firewall send-redirects enable
set firewall source-validation disable
set firewall syn-cookies enable

set interfaces ethernet {{ if_wan }} description WAN
set interfaces ethernet {{ if_wan }} duplex auto
set interfaces ethernet {{ if_wan }} speed auto
set interfaces ethernet {{ if_wan }} address 192.168.2.1/24
set interfaces ethernet {{ if_wan }} firewall in ipv6-name IPv6_WAN_IN
set interfaces ethernet {{ if_wan }} firewall in name WAN_IN
set interfaces ethernet {{ if_wan }} firewall local ipv6-name IPv6_WAN_LOCAL
set interfaces ethernet {{ if_wan }} firewall local name WAN_LOCAL

set interfaces ethernet {{ if_wan }} vif 0 description 'WAN VLAN 0'
set interfaces ethernet {{ if_wan }} vif 0 mac '{{ att_mac }}'
set interfaces ethernet {{ if_wan }} vif 0 address dhcp
set interfaces ethernet {{ if_wan }} vif 0 dhcp-options default-route update
set interfaces ethernet {{ if_wan }} vif 0 dhcp-options default-route-distance 210
set interfaces ethernet {{ if_wan }} vif 0 firewall in ipv6-name IPv6_WAN_IN
set interfaces ethernet {{ if_wan }} vif 0 firewall in name WAN_IN
set interfaces ethernet {{ if_wan }} vif 0 firewall local ipv6-name IPv6_WAN_LOCAL
set interfaces ethernet {{ if_wan }} vif 0 firewall local name WAN_LOCAL
set interfaces ethernet {{ if_wan }} vif 0 dhcpv6-pd duid '{{ att_duid }}'
set interfaces ethernet {{ if_wan }} vif 0 dhcpv6-pd pd 1 interface {{ if_lan }} host-address '::1'
set interfaces ethernet {{ if_wan }} vif 0 dhcpv6-pd pd 1 interface {{ if_lan }} no-dns
set interfaces ethernet {{ if_wan }} vif 0 dhcpv6-pd pd 1 interface {{ if_lan }} prefix-id ':0'
set interfaces ethernet {{ if_wan }} vif 0 dhcpv6-pd pd 1 interface {{ if_lan }} service slaac
set interfaces ethernet {{ if_wan }} vif 0 dhcpv6-pd pd 1 prefix-length 60
set interfaces ethernet {{ if_wan }} vif 0 dhcpv6-pd prefix-only
set interfaces ethernet {{ if_wan }} vif 0 dhcpv6-pd rapid-commit disable
set interfaces ethernet {{ if_wan }} vif 0 ipv6 dup-addr-detect-transmits 1

set interfaces ethernet {{ if_attrg }} description 'ATT Router'
set interfaces ethernet {{ if_attrg }} duplex auto
set interfaces ethernet {{ if_attrg }} speed auto

set interfaces ethernet {{ if_lan }} description LAN
set interfaces ethernet {{ if_lan }} duplex auto
set interfaces ethernet {{ if_lan }} speed auto
set interfaces ethernet {{ if_lan }} mtu 1500
set interfaces ethernet {{ if_lan }} address 192.168.1.254/24

set interfaces loopback lo

set port-forward auto-firewall enable
set port-forward hairpin-nat enable
set port-forward lan-interface {{ if_lan }}
set port-forward wan-interface {{ if_wan_full }}

set port-forward rule 1 description 'Home SSH'
set port-forward rule 1 forward-to address 192.168.1.72
set port-forward rule 1 forward-to port 28
set port-forward rule 1 original-port 28
set port-forward rule 1 protocol tcp

set port-forward rule 2 description 'Minecraft Java'
set port-forward rule 2 forward-to address 192.168.1.72
set port-forward rule 2 forward-to port 25565
set port-forward rule 2 original-port 25565
set port-forward rule 2 protocol tcp

set port-forward rule 3 description 'Minecraft Bedrock'
set port-forward rule 3 forward-to address 192.168.1.72
set port-forward rule 3 forward-to port 19132
set port-forward rule 3 original-port 19132
set port-forward rule 3 protocol tcp

set port-forward rule 4 description 'Home HTTP'
set port-forward rule 4 forward-to address 192.168.1.72
set port-forward rule 4 forward-to port 80
set port-forward rule 4 original-port 80
set port-forward rule 4 protocol tcp

set port-forward rule 5 description 'Home HTTPS'
set port-forward rule 5 forward-to address 192.168.1.72
set port-forward rule 5 forward-to port 443
set port-forward rule 5 original-port 443
set port-forward rule 5 protocol tcp

set port-forward rule 10 description 'Hunter 1'
set port-forward rule 10 forward-to address 192.168.1.73
set port-forward rule 10 forward-to port 31
set port-forward rule 10 original-port 8080
set port-forward rule 10 protocol tcp

set port-forward rule 11 description 'Hunter 2'
set port-forward rule 11 forward-to address 192.168.1.73
set port-forward rule 11 forward-to port 443
set port-forward rule 11 original-port 1723
set port-forward rule 11 protocol tcp

set port-forward rule 12 description 'Hunter 3'
set port-forward rule 12 forward-to address 192.168.1.73
set port-forward rule 12 forward-to port 5209
set port-forward rule 12 original-port 5209
set port-forward rule 12 protocol tcp

set port-forward rule 13 description 'Hunter 4'
set port-forward rule 13 forward-to address 192.168.1.73
set port-forward rule 13 forward-to port 7777
set port-forward rule 13 original-port 7777
set port-forward rule 13 protocol tcp

set service nat rule 5010 description 'masquerade for WAN'
set service nat rule 5010 outbound-interface {{ if_wan_full }}
set service nat rule 5010 type masquerade

set service nat rule 6000 description 'MASQ all networks NTP to WAN'
set service nat rule 6000 log disable
set service nat rule 6000 outbound-interface {{ if_lan }}
set service nat rule 6000 outside-address port 1024-65535
set service nat rule 6000 protocol udp
set service nat rule 6000 source port 123
set service nat rule 6000 type masquerade

set service upnp
set service upnp2 acl rule 9000 action deny
set service upnp2 acl rule 9000 description 'Deny All'
set service upnp2 acl rule 9000 external-port 0-65535
set service upnp2 acl rule 9000 local-port 0-65535
set service upnp2 acl rule 9000 subnet 0.0.0.0/0
set service upnp2 listen-on {{ if_lan }}
set service upnp2 nat-pmp enable
set service upnp2 secure-mode enable
set service upnp2 wan {{ if_wan_full }}

set service dhcp-server disabled false
set service dhcp-server hostfile-update enable
set service dhcp-server shared-network-name LAN1 authoritative enable
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 default-router 192.168.1.254
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 dns-server 192.168.1.254
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 lease 86400
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 start 192.168.1.5 stop 192.168.1.200
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 static-mapping argentina3 ip-address 192.168.1.72
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 static-mapping argentina3 mac-address b4:2e:99:39:db:8b
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 static-mapping omega ip-address 192.168.1.73
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 static-mapping omega mac-address dc:a6:32:1a:14:97
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 static-mapping cellphone ip-address 192.168.1.80
set service dhcp-server shared-network-name LAN1 subnet 192.168.1.0/24 static-mapping cellphone mac-address 58:cb:52:25:92:5a
set service dhcp-server static-arp disable
set service dhcp-server use-dnsmasq disable

set service dns forwarding cache-size 300
set service dns forwarding listen-on {{ if_lan }}
set service dns forwarding name-server 1.1.1.1
set service dns forwarding name-server 1.0.0.1
set service dns forwarding name-server 8.8.8.8
set service dns forwarding name-server 8.8.4.4

set service dns dynamic interface {{ if_wan_full }} service noip host-name panama
set service dns dynamic interface {{ if_wan_full }} service noip login nat1192
set service dns dynamic interface {{ if_wan_full }} service noip password <PASSWORD>

set service gui listen-address 192.168.1.254
set service gui http-port 80
set service gui https-port 443
set service gui older-ciphers disable

set service ssh port 22
set service ssh protocol-version v2
set service unms disable

set system offload ipv6 forwarding enable
set system offload ipv6 vlan enable
set system offload ipv4 vlan enable

set system login user jwilcox authentication plaintext-password <PASSWORD>
set system login user jwilcox level admin

set system host-name nat.ddns.me
